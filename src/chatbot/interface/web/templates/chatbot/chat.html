{% extends "base.html" %} {% block title %}My Data Chat{% endblock %} {% block body %}
<header class="sticky top-0 z-10 border-b border-slate-800/80 bg-slate-950/80 backdrop-blur">
    <div class="mx-auto flex max-w-4xl items-center justify-between px-4 py-3">
        <div class="font-semibold tracking-tight">My Data Chat</div>
        <a href="{% url 'chat_reset' %}" class="text-sm text-slate-300 hover:text-white">Reset</a>
    </div>
</header>

<main class="mx-auto flex h-[calc(100vh-56px)] max-w-4xl flex-col gap-3 px-4 py-4">
    <div
        id="messages"
        class="flex-1 overflow-auto rounded-2xl border border-slate-800 bg-slate-900/40 p-4"
    >
        {% if not history %}
        <div
            class="mx-auto max-w-xl rounded-2xl border border-slate-800 bg-slate-900/60 p-5 text-center text-slate-300"
        >
            Ask something about
            <span class="font-semibold text-white">your documents</span>.<br />
            If it’s not in your data, it will say:
            <span class="font-mono">I don’t know based on my data.</span>
        </div>
        {% endif %}

        <div class="flex flex-col gap-3">
            {% for m in history %} {% if m.role == "user" %}
            <div class="flex justify-end">
                <div
                    class="max-w-[85%] rounded-2xl bg-blue-600/90 px-4 py-3 text-sm leading-relaxed shadow-sm"
                >
                    {{ m.content|linebreaksbr }}
                </div>
            </div>
            {% else %}
            <div class="flex justify-start">
                <div
                    class="max-w-[85%] rounded-2xl border border-slate-800 bg-slate-900 px-4 py-3 text-sm leading-relaxed shadow-sm"
                >
                    <div class="text-slate-100">{{ m.content|linebreaksbr }}</div>

                    {% if m.sources %}
                    <div class="mt-3 flex flex-wrap items-center gap-2 text-xs text-slate-300">
                        <span class="opacity-80">Sources:</span>
                        {% for s in m.sources %}
                        <span
                            class="rounded-full border border-slate-700 bg-slate-950 px-2 py-0.5 text-slate-200"
                        >
                            {{ s }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %} {% endfor %}
        </div>
    </div>

    <form method="post" class="flex gap-2">
        {% csrf_token %}
        <input
            name="message"
            class="flex-1 rounded-2xl border border-slate-800 bg-slate-900 px-4 py-3 text-sm text-slate-100 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/60"
            placeholder="Message…"
            autocomplete="off"
        />
        <button
            class="rounded-2xl border border-slate-800 bg-slate-950 px-4 py-3 text-sm hover:bg-slate-900"
            type="submit"
        >
            Send
        </button>
    </form>
</main>

{% endblock %} {% block scripts %}
<script>
    const el = document.getElementById('messages');
    el.scrollTop = el.scrollHeight;
</script>
{% endblock %}
